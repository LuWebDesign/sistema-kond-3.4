<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mi Cuenta - KOND</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text y='14' font-size='14'>üë§</text></svg>">
  <style>
    :root {
      --bg-primary: #0f172a;
      --bg-secondary: #1e293b;
      --bg-card: #334155;
      --bg-section: #475569;
      --bg-input: #1e293b;
      --bg-hover: #475569;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border-color: #475569;
      --accent-blue: #3b82f6;
      --accent-secondary: #10b981;
    }

    body.light {
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-card: #f1f5f9;
      --bg-section: #e2e8f0;
      --bg-input: #ffffff;
      --bg-hover: #f1f5f9;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --border-color: #e2e8f0;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: all 0.3s ease;
      min-height: 100vh;
    }

    /* Header p√∫blico */
    .public-header {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-blue);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav {
      display: flex;
      gap: 24px;
      align-items: center;
    }

    .nav-link {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s;
    }

    .nav-link:hover {
      background: var(--bg-hover);
      color: var(--accent-blue);
    }

    .nav-link.active {
      background: var(--bg-hover);
      color: var(--accent-blue);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .theme-toggle {
      padding: 8px;
      border-radius: 8px;
      background: var(--bg-section);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    /* Main content */
    .user-main {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      min-height: calc(100vh - 80px);
    }

    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .user-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-blue);
      margin: 0;
    }

    .logout-btn {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .logout-btn:hover {
      background: #dc2626;
    }

    /* Login Form */
    .login-container {
      min-height: 70vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 40px;
      width: 100%;
      max-width: 400px;
    }

    .login-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      text-align: center;
    }

    .login-subtitle {
      color: var(--text-secondary);
      margin-bottom: 32px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--bg-input);
      color: var(--text-primary);
      font-size: 1rem;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .form-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 16px;
    }

    .form-btn.primary {
      background: var(--accent-secondary);
      color: white;
    }

    .form-btn.primary:hover {
      background: #059669;
    }

    .form-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .toggle-btn {
      background: none;
      border: none;
      color: var(--accent-blue);
      cursor: pointer;
      text-decoration: underline;
      font-size: 0.9rem;
    }

    /* Profile sections */
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 32px;
      margin-bottom: 32px;
    }

    .profile-sidebar {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .profile-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
    }

    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: var(--accent-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      margin: 0 auto 16px auto;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .profile-name {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .profile-email {
      color: var(--text-secondary);
      font-size: 0.9rem;
      margin-bottom: 16px;
    }

    .avatar-actions {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .avatar-actions button {
      padding: 6px 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: var(--bg-section);
      color: var(--text-primary);
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.2s;
    }

    .avatar-actions button:hover {
      background: var(--bg-hover);
    }

    .info-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-row {
      margin-bottom: 16px;
    }

    .form-row label {
      display: block;
      margin-bottom: 4px;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--accent-blue);
      color: white;
    }

    .btn-primary:hover {
      background: #2563eb;
    }

    .btn-secondary {
      background: var(--bg-section);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
    }

    /* Orders section */
    .orders-section {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
    }

    .tabs-nav {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .tab-btn {
      padding: 12px 24px;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }

    .tab-btn.active {
      color: var(--accent-blue);
      border-bottom-color: var(--accent-blue);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .order-card {
      background: var(--bg-section);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .order-id {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .order-date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .order-status {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-pending {
      background: #f59e0b;
      color: white;
    }

    .status-delivered {
      background: var(--accent-secondary);
      color: white;
    }

    .order-items {
      margin-bottom: 16px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .order-item:last-child {
      border-bottom: none;
    }

    .item-info {
      flex: 1;
    }

    .item-name {
      font-weight: 500;
      color: var(--text-primary);
    }

    .item-details {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .item-price {
      font-weight: 600;
      color: var(--accent-blue);
    }

    .order-total {
      text-align: right;
      padding-top: 16px;
      border-top: 1px solid var(--border-color);
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--text-secondary);
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      max-width: 300px;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    .toast.success {
      border-left: 4px solid var(--accent-secondary);
    }

    .toast.error {
      border-left: 4px solid #ef4444;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .nav {
        display: none !important;
      }
      
      .header-left {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }

      .profile-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .user-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .tabs-nav {
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <!-- Header p√∫blico -->
  <header class="public-header">
    <div class="header-left">
      <a href="#" onclick="goToCatalog()" class="logo">
        üè™ KOND
      </a>
      
      <nav class="nav">
        <a href="#" onclick="goToCatalog()" class="nav-link">
          üõçÔ∏è Cat√°logo
        </a>
        <a href="#" class="nav-link active">
          üë§ Mi Cuenta
        </a>
      </nav>
    </div>

    <div class="header-right">
      <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
        <span id="theme-icon">‚òÄÔ∏è</span>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="user-main">
    <!-- Vista de login/registro -->
    <div id="login-view" class="login-container">
      <div class="login-card">
        <h1 class="login-title" id="login-title">üë§ Iniciar Sesi√≥n</h1>
        <p class="login-subtitle" id="login-subtitle">Accede a tu cuenta para ver tus pedidos</p>
        
        <form id="auth-form">
          <!-- Campos para registro -->
          <div id="register-fields" style="display: none;">
            <div class="form-group">
              <input type="text" id="reg-nombre" class="form-input" placeholder="Nombre *" required />
            </div>
            <div class="form-group">
              <input type="text" id="reg-apellido" class="form-input" placeholder="Apellido" />
            </div>
            <div class="form-group">
              <input type="tel" id="reg-telefono" class="form-input" placeholder="Tel√©fono" />
            </div>
          </div>

          <!-- Campos comunes -->
          <div class="form-group">
            <input type="email" id="auth-email" class="form-input" placeholder="Email *" required />
          </div>
          <div class="form-group">
            <input type="password" id="auth-password" class="form-input" placeholder="Contrase√±a *" required />
          </div>

          <!-- Campos adicionales para registro -->
          <div id="register-extra-fields" style="display: none;">
            <div class="form-group">
              <input type="text" id="reg-direccion" class="form-input" placeholder="Direcci√≥n" />
            </div>
            <div class="form-group">
              <input type="text" id="reg-localidad" class="form-input" placeholder="Localidad" />
            </div>
            <div class="form-group">
              <input type="text" id="reg-cp" class="form-input" placeholder="C√≥digo Postal" />
            </div>
            <div class="form-group">
              <input type="text" id="reg-provincia" class="form-input" placeholder="Provincia" />
            </div>
          </div>

          <button type="submit" class="form-btn primary" id="auth-submit-btn">
            üöÄ Iniciar Sesi√≥n
          </button>

          <div style="text-align: center;">
            <button type="button" class="toggle-btn" id="auth-toggle-btn">
              ¬øNo tienes cuenta? Reg√≠strate aqu√≠
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Vista del usuario logueado -->
    <div id="user-view" style="display: none;">
      <div class="user-header">
        <h1 class="user-title">üë§ Mi Cuenta</h1>
        <button class="logout-btn" onclick="logout()">
          üö™ Cerrar Sesi√≥n
        </button>
      </div>

      <div class="profile-grid">
        <!-- Sidebar con info del usuario -->
        <div class="profile-sidebar">
          <div class="profile-card">
            <div class="avatar" id="user-avatar">
              <span id="avatar-text">U</span>
              <img id="avatar-image" style="display: none;" />
            </div>
            <div class="profile-name" id="user-display-name">Usuario</div>
            <div class="profile-email" id="user-email">usuario@email.com</div>
            
            <div class="avatar-actions">
              <input type="file" id="avatar-input" accept="image/*" style="display: none;" />
              <button onclick="document.getElementById('avatar-input').click()">
                üì∑ Cambiar foto
              </button>
              <button onclick="removeAvatar()">
                üóëÔ∏è Eliminar
              </button>
            </div>
          </div>

          <div class="info-card">
            <div class="card-title">
              üìù Informaci√≥n personal
            </div>
            
            <form id="profile-form">
              <div class="form-row">
                <label>Nombre</label>
                <input type="text" id="profile-nombre" class="form-input" />
              </div>
              <div class="form-row">
                <label>Apellido</label>
                <input type="text" id="profile-apellido" class="form-input" />
              </div>
              <div class="form-row">
                <label>Tel√©fono</label>
                <input type="tel" id="profile-telefono" class="form-input" />
              </div>
              <div class="form-row">
                <label>Direcci√≥n</label>
                <input type="text" id="profile-direccion" class="form-input" />
              </div>
              <div class="form-row">
                <label>Localidad</label>
                <input type="text" id="profile-localidad" class="form-input" />
              </div>
              <div class="form-row">
                <label>C√≥digo Postal</label>
                <input type="text" id="profile-cp" class="form-input" />
              </div>
              <div class="form-row">
                <label>Provincia</label>
                <input type="text" id="profile-provincia" class="form-input" />
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="toggleProfileEdit()">
                  ‚úèÔ∏è Editar
                </button>
                <button type="submit" class="btn btn-primary" id="save-profile-btn" style="display: none;">
                  üíæ Guardar
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Main content con pedidos -->
        <div class="orders-section">
          <div class="card-title">
            üìã Mis Pedidos
          </div>
          
          <div class="tabs-nav">
            <button class="tab-btn active" onclick="showTab('pending')">
              ‚è≥ Pendientes
            </button>
            <button class="tab-btn" onclick="showTab('delivered')">
              ‚úÖ Entregados
            </button>
          </div>
          
          <div id="pending-orders" class="tab-content active">
            <div id="pending-orders-list"></div>
            <div id="pending-empty" class="empty-state">
              No tienes pedidos pendientes
            </div>
          </div>
          
          <div id="delivered-orders" class="tab-content">
            <div id="delivered-orders-list"></div>
            <div id="delivered-empty" class="empty-state">
              No tienes pedidos entregados
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Estado global
    let currentUser = null
    let isLoginMode = true
    let currentTheme = 'dark'
    let isEditingProfile = false

    // Funciones de navegaci√≥n
    function goToCatalog() {
      // Detectar si estamos en el contexto de Next.js
      const isNextJS = window.location.pathname.startsWith('/') && 
                     (window.location.hostname === 'localhost' || 
                      window.location.pathname.includes('/_next'))
      
      if (isNextJS) {
        // Si estamos en Next.js, usar ruta de Next.js
        window.location.href = '/catalog'
      } else {
        // Si es archivo HTML est√°tico, usar catalog-public.html
  window.location.href = '/catalog'
      }
    }

    // Inicializaci√≥n
    document.addEventListener('DOMContentLoaded', function() {
      loadTheme()
      loadCurrentUser()
      setupEventListeners()
    })

    // Gesti√≥n de tema
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'dark'
      currentTheme = savedTheme
      document.body.className = savedTheme
      document.getElementById('theme-icon').textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô'
    }

    function toggleTheme() {
      currentTheme = currentTheme === 'dark' ? 'light' : 'dark'
      localStorage.setItem('theme', currentTheme)
      document.body.className = currentTheme
      document.getElementById('theme-icon').textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô'
    }

    // Cargar usuario actual
    function loadCurrentUser() {
      try {
        const user = JSON.parse(localStorage.getItem('currentUser'))
        if (user) {
          currentUser = user
          showUserView()
        } else {
          showLoginView()
        }
      } catch (error) {
        console.error('Error loading user:', error)
        showLoginView()
      }
    }

    // Configurar event listeners
    function setupEventListeners() {
      // Formulario de autenticaci√≥n
      document.getElementById('auth-form').addEventListener('submit', handleAuth)
      document.getElementById('auth-toggle-btn').addEventListener('click', toggleAuthMode)
      
      // Formulario de perfil
      document.getElementById('profile-form').addEventListener('submit', handleProfileSave)
      
      // Avatar
      document.getElementById('avatar-input').addEventListener('change', handleAvatarChange)
    }

    // Mostrar vista de login
    function showLoginView() {
      document.getElementById('login-view').style.display = 'flex'
      document.getElementById('user-view').style.display = 'none'
    }

    // Mostrar vista de usuario
    function showUserView() {
      document.getElementById('login-view').style.display = 'none'
      document.getElementById('user-view').style.display = 'block'
      
      updateUserUI()
      loadUserOrders()
    }

    // Alternar modo de autenticaci√≥n
    function toggleAuthMode() {
      isLoginMode = !isLoginMode
      
      const title = document.getElementById('login-title')
      const subtitle = document.getElementById('login-subtitle')
      const submitBtn = document.getElementById('auth-submit-btn')
      const toggleBtn = document.getElementById('auth-toggle-btn')
      const registerFields = document.getElementById('register-fields')
      const registerExtraFields = document.getElementById('register-extra-fields')
      
      if (isLoginMode) {
        title.textContent = 'üë§ Iniciar Sesi√≥n'
        subtitle.textContent = 'Accede a tu cuenta para ver tus pedidos'
        submitBtn.textContent = 'üöÄ Iniciar Sesi√≥n'
        toggleBtn.textContent = '¬øNo tienes cuenta? Reg√≠strate aqu√≠'
        registerFields.style.display = 'none'
        registerExtraFields.style.display = 'none'
      } else {
        title.textContent = 'üìù Registrarse'
        subtitle.textContent = 'Crea una cuenta para realizar pedidos'
        submitBtn.textContent = 'üìù Registrarse'
        toggleBtn.textContent = '¬øYa tienes cuenta? Inicia sesi√≥n aqu√≠'
        registerFields.style.display = 'block'
        registerExtraFields.style.display = 'block'
      }
    }

    // Manejar autenticaci√≥n
    async function handleAuth(e) {
      e.preventDefault()
      
      const email = document.getElementById('auth-email').value
      const password = document.getElementById('auth-password').value
      
      if (isLoginMode) {
        // Login
        const users = JSON.parse(localStorage.getItem('users') || '[]')
        const user = users.find(u => u.email === email && u.password === password)
        
        if (user) {
          currentUser = user
          localStorage.setItem('currentUser', JSON.stringify(user))
          showUserView()
          showToast('¬°Bienvenido!', 'success')
        } else {
          showToast('Email o contrase√±a incorrectos', 'error')
        }
      } else {
        // Registro
        const nombre = document.getElementById('reg-nombre').value
        const apellido = document.getElementById('reg-apellido').value
        const telefono = document.getElementById('reg-telefono').value
        const direccion = document.getElementById('reg-direccion').value
        const localidad = document.getElementById('reg-localidad').value
        const cp = document.getElementById('reg-cp').value
        const provincia = document.getElementById('reg-provincia').value
        
        if (!email || !password || !nombre) {
          showToast('Completa los campos obligatorios', 'error')
          return
        }
        
        const users = JSON.parse(localStorage.getItem('users') || '[]')
        
        if (users.find(u => u.email === email)) {
          showToast('Ya existe una cuenta con este email', 'error')
          return
        }
        
        const newUser = {
          id: Date.now(),
          email,
          password,
          nombre,
          apellido,
          telefono,
          direccion,
          localidad,
          cp,
          provincia,
          fechaRegistro: new Date().toISOString()
        }
        
        users.push(newUser)
        localStorage.setItem('users', JSON.stringify(users))
        
        currentUser = newUser
        localStorage.setItem('currentUser', JSON.stringify(newUser))
        
        showUserView()
        showToast('¬°Cuenta creada exitosamente!', 'success')
      }
    }

    // Actualizar UI del usuario
    function updateUserUI() {
      if (!currentUser) return
      
      document.getElementById('user-display-name').textContent = 
        currentUser.nombre + (currentUser.apellido ? ' ' + currentUser.apellido : '')
      document.getElementById('user-email').textContent = currentUser.email
      
      // Avatar
      const avatarText = document.getElementById('avatar-text')
      const avatarImage = document.getElementById('avatar-image')
      
      if (currentUser.avatar) {
        avatarText.style.display = 'none'
        avatarImage.style.display = 'block'
        avatarImage.src = currentUser.avatar
      } else {
        avatarText.style.display = 'block'
        avatarImage.style.display = 'none'
        avatarText.textContent = currentUser.nombre.charAt(0).toUpperCase()
      }
      
      // Formulario de perfil
      document.getElementById('profile-nombre').value = currentUser.nombre || ''
      document.getElementById('profile-apellido').value = currentUser.apellido || ''
      document.getElementById('profile-telefono').value = currentUser.telefono || ''
      document.getElementById('profile-direccion').value = currentUser.direccion || ''
      document.getElementById('profile-localidad').value = currentUser.localidad || ''
      document.getElementById('profile-cp').value = currentUser.cp || ''
      document.getElementById('profile-provincia').value = currentUser.provincia || ''
      
      // Deshabilitar campos inicialmente
      toggleProfileFields(false)
    }

    // Manejar cambio de avatar
    function handleAvatarChange(e) {
      const file = e.target.files[0]
      if (!file) return
      
      if (file.size > 2 * 1024 * 1024) {
        showToast('La imagen debe ser menor a 2MB', 'error')
        return
      }
      
      const reader = new FileReader()
      reader.onload = (e) => {
        currentUser.avatar = e.target.result
        updateUser()
        updateUserUI()
        showToast('Avatar actualizado', 'success')
      }
      reader.readAsDataURL(file)
    }

    // Eliminar avatar
    function removeAvatar() {
      currentUser.avatar = null
      updateUser()
      updateUserUI()
      showToast('Avatar eliminado', 'success')
    }

    // Toggle edici√≥n de perfil
    function toggleProfileEdit() {
      isEditingProfile = !isEditingProfile
      toggleProfileFields(isEditingProfile)
      
      const editBtn = document.querySelector('button[onclick="toggleProfileEdit()"]')
      const saveBtn = document.getElementById('save-profile-btn')
      
      if (isEditingProfile) {
        editBtn.style.display = 'none'
        saveBtn.style.display = 'block'
      } else {
        editBtn.style.display = 'block'
        saveBtn.style.display = 'none'
        updateUserUI() // Restaurar valores originales
      }
    }

    // Habilitar/deshabilitar campos de perfil
    function toggleProfileFields(enabled) {
      const fields = [
        'profile-nombre', 'profile-apellido', 'profile-telefono',
        'profile-direccion', 'profile-localidad', 'profile-cp', 'profile-provincia'
      ]
      
      fields.forEach(id => {
        document.getElementById(id).disabled = !enabled
      })
    }

    // Guardar perfil
    function handleProfileSave(e) {
      e.preventDefault()
      
      currentUser.nombre = document.getElementById('profile-nombre').value
      currentUser.apellido = document.getElementById('profile-apellido').value
      currentUser.telefono = document.getElementById('profile-telefono').value
      currentUser.direccion = document.getElementById('profile-direccion').value
      currentUser.localidad = document.getElementById('profile-localidad').value
      currentUser.cp = document.getElementById('profile-cp').value
      currentUser.provincia = document.getElementById('profile-provincia').value
      
      updateUser()
      toggleProfileEdit()
      showToast('Perfil actualizado', 'success')
    }

    // Actualizar usuario en localStorage
    function updateUser() {
      localStorage.setItem('currentUser', JSON.stringify(currentUser))
      
      const users = JSON.parse(localStorage.getItem('users') || '[]')
      const index = users.findIndex(u => u.id === currentUser.id)
      if (index >= 0) {
        users[index] = currentUser
        localStorage.setItem('users', JSON.stringify(users))
      }
    }

    // Cargar pedidos del usuario
    function loadUserOrders() {
      try {
        const allOrders = JSON.parse(localStorage.getItem('pedidosCatalogo') || '[]')
        const userOrders = allOrders.filter(order => 
          order.userEmail === currentUser.email || order.userId === currentUser.id
        )
        
        displayOrders(userOrders)
      } catch (error) {
        console.error('Error loading orders:', error)
      }
    }

    // Mostrar pedidos
    function displayOrders(orders) {
      const pendingOrders = orders.filter(o => o.estado !== 'entregado')
      const deliveredOrders = orders.filter(o => o.estado === 'entregado')
      
      displayOrdersList(pendingOrders, 'pending-orders-list', 'pending-empty')
      displayOrdersList(deliveredOrders, 'delivered-orders-list', 'delivered-empty')
    }

    // Mostrar lista de pedidos
    function displayOrdersList(orders, containerId, emptyId) {
      const container = document.getElementById(containerId)
      const emptyState = document.getElementById(emptyId)
      
      if (orders.length === 0) {
        container.innerHTML = ''
        emptyState.style.display = 'block'
        return
      }
      
      emptyState.style.display = 'none'
      container.innerHTML = orders.map(order => `
        <div class="order-card">
          <div class="order-header">
            <div>
              <div class="order-id">${getStatusEmoji(order.estado)} Pedido #${order.id}</div>
              <div class="order-date">${formatDate(order.fechaCreacion)}</div>
            </div>
            <div class="order-status ${getStatusClass(order.estado)}">
              ${getStatusLabel(order.estado)}
            </div>
          </div>
          
          <div class="order-items">
            ${order.items.map(item => `
              <div class="order-item">
                <div class="item-info">
                  <div class="item-name">${item.name}</div>
                  <div class="item-details">${item.measures || ''} √ó ${item.quantity}</div>
                </div>
                <div class="item-price">${formatCurrency(item.price * item.quantity)}</div>
              </div>
            `).join('')}
          </div>
          
          <div class="order-total">
            Total: ${formatCurrency(order.total)}
          </div>
        </div>
      `).join('')
    }

    // Alternar tabs
    function showTab(tab) {
      // Actualizar botones
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'))
      event.target.classList.add('active')
      
      // Mostrar contenido
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'))
      document.getElementById(tab === 'pending' ? 'pending-orders' : 'delivered-orders').classList.add('active')
    }

    // Cerrar sesi√≥n
    function logout() {
      currentUser = null
      localStorage.removeItem('currentUser')
      showLoginView()
      showToast('Sesi√≥n cerrada', 'success')
    }

    // Utilidades
    function formatCurrency(amount) {
      return new Intl.NumberFormat('es-AR', {
        style: 'currency',
        currency: 'ARS'
      }).format(amount)
    }

    function formatDate(dateStr) {
      return new Date(dateStr).toLocaleDateString('es-AR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      })
    }

    function getStatusEmoji(status) {
      const emojis = {
        'pendiente': '‚è≥',
        'en_produccion': 'üî®',
        'listo': '‚úÖ',
        'entregado': 'üì¶',
        'cancelado': '‚ùå'
      }
      return emojis[status] || 'üìã'
    }

    function getStatusLabel(status) {
      const labels = {
        'pendiente': 'Pendiente',
        'en_produccion': 'En Producci√≥n',
        'listo': 'Listo',
        'entregado': 'Entregado',
        'cancelado': 'Cancelado'
      }
      return labels[status] || status
    }

    function getStatusClass(status) {
      return status === 'entregado' ? 'status-delivered' : 'status-pending'
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div')
      toast.className = `toast ${type}`
      toast.textContent = message
      
      document.body.appendChild(toast)
      
      setTimeout(() => {
        toast.remove()
      }, 3000)
    }
  </script>
</body>
</html>